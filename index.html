<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="./styles.css">

    <title>Property Details Using Hyperledger Fabric</title>
</head>

<body>
    <div class="text-center">
        <h1>
            Property
        </h1>
        <button onclick="getAll()">Get All Information</button>
        <span>||</span>
        <input id="search-input" type="text">
        <button onclick="search()">Search</button>
        <div id="show-car"></div>
    </div>



    <div class="text-center">
        <input id="search1-input" type="text">
        <button onclick="search1()">Search</button>
        <div id="show-car"></div>
    </div>



    <div class="text-center form-container">
        <h3>Create Property Details</h3>
        <form id="createForm" action="" name="createCar">
            <div>
                <label for="">Give a key</label>
                <input name="key" />
            </div>

            <div>
                <label for="">Address</label>
                <input name="make" />
            </div>

            <div>
                <label for="">City</label>
                <input name="model" />
            </div>

            <div>
                <label for="">Property Size</label>
                <input name="color" />
            </div>

            <div>
                <label for="">Owner Name</label>
                <input name="owner" />
            </div>

            <div>
                <label for="">Property Type</label>
                <input name="type" />
            </div>

            <div>
                <button type="submit">Create</button>
            </div>
        </form>
    </div>

    <div class="text-center form-container">
        <h3>Update Owner</h3>
        <form id="updateForm" action="" name="updateOwner">
            <div>
                <label for="">Give your key</label>
                <input name="key" />
            </div>

            <div>
                <label for="">New Owner Name</label>
                <input name="owner" />
            </div>

            <div>
                <button type="submit">Update</button>
            </div>
        </form>
    </div>
    <div class="text-center form-container">
        <h3>Update Address</h3>
        <form id="updateFormm" action="" name="updateAddress">
            <div>
                <label for="">Give your key</label>
                <input name="key" />
            </div>

            <div>
                <label for="">Update Address</label>
                <input name="make" />
            </div>

            <div>
                <button type="submit">Update</button>
            </div>
        </form>
    </div>
    <div class="text-center form-container">
        <h3>Update City</h3>
        <form id="updateFormmm" action="" name="updateCity">
            <div>
                <label for="">Give your key</label>
                <input name="key" />
            </div>

            <div>
                <label for="">Update City</label>
                <input name="model" />
            </div>

            <div>
                <button type="submit">Update</button>
            </div>
        </form>
    </div>
    <div class="text-center form-container">
        <h3>Update Size</h3>
        <form id="updateFormmmm" action="" name="updateSize">
            <div>
                <label for="">Give your key</label>
                <input name="key" />
            </div>

            <div>
                <label for="">Update Size</label>
                <input name="color" />
            </div>

            <div>
                <button type="submit">Update</button>
            </div>
        </form>
    </div>
    <div class="text-center form-container">
        <h3>Update Property Type</h3>
        <form id="updateFormmmmm" action="" name="updateType">
            <div>
                <label for="">Give your key</label>
                <input name="key" />
            </div>

            <div>
                <label for="">Update Type</label>
                <input name="type" />
            </div>

            <div>
                <button type="submit">Update</button>
            </div>
        </form>
    </div>

    <script>

        // CREATING NEW CAR
        const createForm = document.getElementById('createForm')

        // THIS IS AN EVENT LISTENER WHICH WILL RUN WHEN WE CLICK THE CREATE BUTTON
        createForm.addEventListener("submit", function (event) {
            event.preventDefault()
            const bodyParam = new URLSearchParams(new FormData(createForm))

            //CALLING CREATE API
            fetch('http://localhost:3000/create', {
                method: 'POST',
                body: bodyParam
            })
                .then(res => {
                    return res.json()
                })
                .then(parsedRes => {
                    alert(parsedRes.message)
                })
                .catch(err => {
                    console.error({ err })
                })
        });

        // UPDATE: CHANGING CAR OWNER
        const updateForm = document.getElementById('updateForm')

        // THIS IS AN EVENT LISTENER WHICH WILL RUN WHEN WE CLICK THE UPDATE BUTTON
        updateForm.addEventListener("submit", function (event) {
            event.preventDefault()
            const bodyParam = new URLSearchParams(new FormData(updateForm))

            //CALLING UPDATE API
            fetch('http://localhost:3000/update', {
                method: 'POST',
                body: bodyParam
            })
                .then(res => {
                    if (res.status !== 200) {
                        alert('Unable to update')
                        return
                    }
                    return res.json()
                })
                .then(parsedRes => {
                    alert(parsedRes.message)
                    getAll()
                })
                .catch(err => {
                    alert(err.message)
                    console.error({ err })
                })
        });
        // UPDATE: CHANGING Address
        const updateFormm = document.getElementById('updateFormm')

        // THIS IS AN EVENT LISTENER WHICH WILL RUN WHEN WE CLICK THE UPDATE BUTTON
        updateFormm.addEventListener("submit", function (event) {
            event.preventDefault()
            const bodyParam = new URLSearchParams(new FormData(updateFormm))

            //CALLING UPDATE API
            fetch('http://localhost:3000/updateaddress', {
                method: 'POST',
                body: bodyParam
            })
                .then(res => {
                    if (res.status !== 200) {
                        alert('Unable to update')
                        return
                    }
                    return res.json()
                })
                .then(parsedRes => {
                    alert(parsedRes.message)
                    getAll()
                })
                .catch(err => {
                    alert(err.message)
                    console.error({ err })
                })
        });
        // UPDATE: CHANGING City
        const updateFormmm = document.getElementById('updateFormmm')

        // THIS IS AN EVENT LISTENER WHICH WILL RUN WHEN WE CLICK THE UPDATE BUTTON
        updateFormmm.addEventListener("submit", function (event) {
            event.preventDefault()
            const bodyParam = new URLSearchParams(new FormData(updateFormmm))

            //CALLING UPDATE API
            fetch('http://localhost:3000/updatecity', {
                method: 'POST',
                body: bodyParam
            })
                .then(res => {
                    if (res.status !== 200) {
                        alert('Unable to update')
                        return
                    }
                    return res.json()
                })
                .then(parsedRes => {
                    alert(parsedRes.message)
                    getAll()
                })
                .catch(err => {
                    alert(err.message)
                    console.error({ err })
                })
        });
        const updateFormmmm = document.getElementById('updateFormmmm')

        // THIS IS AN EVENT LISTENER WHICH WILL RUN WHEN WE CLICK THE UPDATE BUTTON
        updateFormmmm.addEventListener("submit", function (event) {
            event.preventDefault()
            const bodyParam = new URLSearchParams(new FormData(updateFormmmm))

            //CALLING UPDATE API
            fetch('http://localhost:3000/updatesize', {
                method: 'POST',
                body: bodyParam
            })
                .then(res => {
                    if (res.status !== 200) {
                        alert('Unable to update')
                        return
                    }
                    return res.json()
                })
                .then(parsedRes => {
                    alert(parsedRes.message)
                    getAll()
                })
                .catch(err => {
                    alert(err.message)
                    console.error({ err })
                })
        });
        const updateFormmmmm = document.getElementById('updateFormmmmm')

        // THIS IS AN EVENT LISTENER WHICH WILL RUN WHEN WE CLICK THE UPDATE BUTTON
        updateFormmmmm.addEventListener("submit", function (event) {
            event.preventDefault()
            const bodyParam = new URLSearchParams(new FormData(updateFormmmmm))

            //CALLING UPDATE API
            fetch('http://localhost:3000/updatetype', {
                method: 'POST',
                body: bodyParam
            })
                .then(res => {
                    if (res.status !== 200) {
                        alert('Unable to update')
                        return
                    }
                    return res.json()
                })
                .then(parsedRes => {
                    alert(parsedRes.message)
                    getAll()
                })
                .catch(err => {
                    alert(err.message)
                    console.error({ err })
                })
        });


        //SEARCH DATA KEY
        function search() {
            // extracting value from input field
            const value = document.getElementById('search-input').value
            getAll(value)
        }

        // GETTING ALL CAR DATA FROM API
        function getAll(query) {
            const api = query ? 'http://localhost:3000/get-car?key=' + query : 'http://localhost:3000/get-car'
            fetch(api)
                .then(res => {
                    return res.json();
                })
                .then(parsedRes => {
                    let carMarkup = '';
                    parsedRes.forEach(item => {
                        carMarkup = carMarkup +
                            `<div class="car-item"> 
                                <p>Key: ${item.Key}</p>
                                <p>Address: ${item.Record.make}</p>
                                <p>City: ${item.Record.model}</p>
                                <p>Property Size: ${item.Record.color}</p>
                                <p>Owner Name: ${item.Record.owner}</p>
                                <p>Property Type: ${item.Record.type}</p>
                            </div>`
                        
                    })
                    // getting the html container with id=show-car
                    const carContainer = document.getElementById('show-car')

                    //CLEANING EXISTING CAR HTML NODE/ELEMENT
                    while (carContainer.hasChildNodes()) {
                        carContainer.removeChild(carContainer.firstChild);
                    }

                    // Adding new car data markup
                    carContainer.insertAdjacentHTML('beforeend', carMarkup)
                })
                .catch(err => {
                    alert('Operation failed')
                    console.error({ err })
                })
        }

         //SEARCH DATA City
         function search1() {
            // extracting value from input field
            const value = document.getElementById('search1-input').value
            console.log(value)
            getAll1(value)
        }

        // GETTING ALL CAR DATA FROM API
        function getAll1(query) {
            console.log(query)
            const api = query ? 'http://localhost:3000/get-car?Model=' + query : 'http://localhost:3000/get-car'
            console.log(api)
            console.log(typeof(query))
            fetch(api)
                .then(res => {
                    console.log(res.json)
                    return res.json();
                })
                .then(parsedRes => {
                    let carMarkup = '';
                    
                    parsedRes.forEach(item => {
                        if(item.Record.model == query) 
                        {
                            carMarkup = carMarkup +
                            `<div class="car-item"> 
                                <p>Key: ${item.Key}</p>
                                <p>Address: ${item.Record.make}</p>
                                <p>City: ${item.Record.model}</p>
                                <p>Property Size: ${item.Record.color}</p>
                                <p>Owner Name: ${item.Record.owner}</p>
                                <p>Property Type: ${item.Record.type}</p>
                            </div>`
                       }
                    })
                    // getting the html container with id=show-car
                    const carContainer = document.getElementById('show-car')

                    //CLEANING EXISTING CAR HTML NODE/ELEMENT
                    while (carContainer.hasChildNodes()) {
                        carContainer.removeChild(carContainer.firstChild);
                    }

                    // Adding new car data markup
                    carContainer.insertAdjacentHTML('beforeend', carMarkup)
                })
                .catch(err => {
                    alert('Operation failed')
                    console.error({ err })
                })
        }



    </script>
</body>

</html>